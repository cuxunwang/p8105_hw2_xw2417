---
title: "P8105 Homework 2 Solution"
author: "Xun Wang"
date: "9/25/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
```

This file is the solution to P8105 Homework 2 from Xun Wang (xw2417).

## Problem 1

This problem uses the *Mr. Trash Wheel* dataset. 

#### 1.1 Read and clean the Mr. Trash Wheel sheet.

The code chunk below reads and cleans the *Mr. Trash Wheel* sheet. It omits non-data entrues and rows not including dumpster-specific data, and rounds the number of sports balls to the nearest integer and converts the result to an integer variable.

```{r read_mr_trash_wheel}
mr_trash_wheel_data = 
  readxl::read_excel(
    "data/HealthyHarborWaterWheelTotals2018-7-28.xlsx",
    sheet = "Mr. Trash Wheel",
    range = "A2:N338"
    ) %>%
  janitor::clean_names() %>%
  drop_na(dumpster) %>% 
  mutate(
    date = str_sub(as.character(date), -2, -1),
    sports_balls = as.integer(sports_balls)) %>% 
  select(dumpster, year, month, day = date, everything()) %>% 
  pivot_longer(
    plastic_bottles:sports_balls,
    names_to = "trash_category",
    values_to = "number"
  ) %>% 
  mutate(number = as.numeric(number))
```


#### 1.2 Read and clean precipitation data.

The code chunk below read and clean precipitation data for 2017 and 2018. It omits rows without precipitation data and adds a variable year. Then, it combines precipitation datasets and convert month to a character variable.

```{r read_precipitation}
precip_data_2017 = 
  readxl::read_excel(
    "data/HealthyHarborWaterWheelTotals2018-7-28.xlsx",
    sheet = "2017 Precipitation",
    range = "A2:B14"
    ) %>%
  mutate(year = "2017") %>% 
  janitor::clean_names() 

precip_data_2018 = 
  readxl::read_excel(
    "data/HealthyHarborWaterWheelTotals2018-7-28.xlsx",
    sheet = "2018 Precipitation",
    range = "A2:B14"
    ) %>%
  mutate(year = "2018") %>% 
  janitor::clean_names() %>% 
  drop_na(total)

precip_data = 
  bind_rows(precip_data_2017, precip_data_2018) %>%
  mutate(month = month.name[month]) %>% 
  select(year, month, total_inch = total)
```

#### 1.3 Comments.

**Comments on cleaning data:** Both the *Mr. Trash Wheel* and the *precipitation* datasets are cleaned by `janitor::clean_names`. The *Mr. Trash Wheel* data is also tidied by `pivot_longer` (I combined all the different trash types into one column named *trash_category* and put the values to the column *number*). Since there are column *year* and *month* already, I simplied the *date* column to *day* column only leaving the "day" information in this column.

**Comments on the data:** The *Mr. Trash Wheel* dataset has `r nrow(mr_trash_wheel_data)` rows and `r ncol(mr_trash_wheel_data)` columns. There are `r max(pull(mr_trash_wheel_data, dumpster))` observations between 5/16/2014 and 7/18/2018 for 7 categories of trash. The total weight and volume of trash, and the home number the trash powered in each observation are also recorded. The **key** variable is the *dumpster* number. 

The *precipitation* dataset has `r nrow(precip_data)` rows and `r ncol(precip_data)` columns. There are `r nrow(precip_data)` observations between `r pull(precip_data, month)[1]` `r pull(precip_data, year)[1]` and `r rev(pull(precip_data, month))[1]` `r rev(pull(precip_data, year))[1]`. For each observation, the total inches of the precipitation was recored. The **key** variables are the *year* and *month*. 

For available data, the **total** precipitation in 2018 was **`r sum(select(filter(precip_data, year == 2018), total_inch))` inches**. The **median** number of sports balls in a dumpster in 2017 was **`r median(pull(filter(mr_trash_wheel_data, year == 2017 & trash_category == 'sports_balls'), number))`**.

## Problem 2

This problem uses the *FiveThirtyEight* dataset. 

#### 2.1 Read and clean the datasets.

The code chunk below reads and cleans the data in pols-month.csv. Note that there are some "2"s in the *prez_gop* data, and I consider those observations as "1"s.

```{r read_pols_month}
party = c("dem", "gop", "gop")

pols_data = 
  read.csv(file = "./data/fivethirtyeight_datasets/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("year", "month", "day")) %>% 
  mutate(month = month.name[as.integer(month)],
         president = party[prez_gop + 1]) %>%
  select(year, month, president, everything(), -day, -prez_dem, -prez_gop)
```

The code chunk below reads and cleans the data in snp.csv. To make the variable name more clear, variable name *close* is repalced by *snp_index*.

```{r read_snp}
snp_data = 
  read.csv(file = "./data/fivethirtyeight_datasets/snp.csv") %>% 
  janitor::clean_names() %>% 
  separate(date, into = c("month", "day", "year")) %>% 
  mutate(month = month.name[as.integer(month)]) %>% 
  select(year, month, snp_index = close)
```

The code chunk below reads and cleans the data in unemployment.csv. To make the variable name more clear, variable name *percentage* is repalced by *unemploy_percentage*.

```{r read_unemployment}
unemploy_data = 
  read.csv(file = "./data/fivethirtyeight_datasets/unemployment.csv") %>% 
  ##janitor::clean_names() %>% 
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "percentage"
  ) %>% 
  mutate(month = month.name[match(pull(., month), month.abb)],
         Year = as.character(Year)) %>% 
  select(year = Year, month, unemploy_percentage = percentage)
```

#### 2.2 Join the datasets.

The code chunk below merges `snp` into `pols` by `left_join`, and then merges `unemployment` into the result by `left_join` again. Because the `pols` data has the longest time span, so most information would be kept if the other 2 datasets are **left joined** into the `pols` dataset. 

```{r join_538_datasets}
pols_snp_unemploy = 
  left_join(pols_data, snp_data, by = c("year", "month")) %>% 
  left_join(unemploy_data, by = c("year", "month")) %>% 
  drop_na(snp_index, unemploy_percentage)
```

#### 2.3 Comments.

The `pols_data` has `r nrow(pols_data)` rows and `r ncol(pols_data)` columns, indicating in a specific year and month, whether the president was republican (`gop`) or democratic (`dem`), and the numbers of republican / democratic governors (`gov_gop` / `gov_dem`), senators (`sen_gop` / `sen_dem`) and representatives (`rep_gop` / `rep_dem`).

The `snp_data` has `r nrow(snp_data)` rows and `r ncol(snp_data)` columns, indicating the closing values of the S&P stock index at the beginning of a specific year and month.

The `unemploy_data` has `r nrow(unemploy_data)` rows and `r ncol(unemploy_data)` columns, indicating the percentage of unemployment in a specific year and month.

Since the `pols_data` has the most information, I did `left_join` to merge the `snp_data` and the `unemploy_data` into the `pols_data` one by one. Then any row with a missing value was removed. The resulting dataset `pols_snp_unemploy` has **`r nrow(pols_snp_unemploy)` rows** and **`r ncol(pols_snp_unemploy)` columns**, ranging from **`r pull(pols_snp_unemploy, month)[1]` `r pull(pols_snp_unemploy, year)[1]`** to **`r rev(pull(pols_snp_unemploy, month))[1]` `r rev(pull(pols_snp_unemploy, year))[1]`**. The **key** varibales are *year* and *month*. And the resulting dataset gives us whether the president was republican or democratic, the numbers of republican / democratic governors / senators / representatives, the closing values of the S&P stock index, and the percentage of unemployment in a specific year and month.

## Problem 3